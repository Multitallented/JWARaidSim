
<div class="container {{nation}}">

  <div class="right list-resources faction-bg">
    {{getPoints() + getFactionPoints()}} pts | {{getOptions()}} opts
  </div>

  <div class="nation-select">
    <h3>Select Your Faction</h3>
    <a class="ru" (click)="selectNation('russian');">
      <img src="/assets/flags/ru.png" alt="Soviet Russia" />
    </a>
    <a class="de" (click)="selectNation('german');">
      <img src="/assets/flags/de.png" alt="Nazi Germany" />
    </a>
    <a class="us" (click)="selectNation('american');">
      <img src="/assets/flags/us.png" alt="United States" />
    </a>
    <a class="ja" (click)="selectNation('japanese');">
      <img src="/assets/flags/ja.png" alt="Imperial Japan" />
    </a>
    <a class="zh" (click)="selectNation('chinese');">
      <img src="/assets/flags/zh.png" alt="China" />
    </a>
    <a class="it" (click)="selectNation('italian');">
      <img src="/assets/flags/it.png" alt="Italy" />
    </a>
    <a class="uk" (click)="selectNation('british');">
      <img src="/assets/flags/uk.png" alt="British Commonwealth" />
    </a>
    <a class="ina" (click)="selectNation('indian');">
      <img src="/assets/flags/ina.png" alt="Indian National Army" />
    </a>
    <a class="fr" (click)="selectNation('french');">
      <img src="/assets/flags/fr.png" alt="France" />
    </a>
  </div>

  <div class="clearfix"></div>

  <div class="row">
    <div class="col wdth-33">
      <div *ngIf="!faction">
        <h3>Factions</h3>
        <div *ngFor="let currentFaction of factionList">
          <a class="right" (click)="selectFaction(currentFaction)">Select</a>
          <a class="right" (click)="selectedFaction = currentFaction">Preview</a>
          <span class="name">{{currentFaction.name}}</span>
        </div>
      </div>
      <div *ngIf="nation && faction">
        <h3>Options</h3>
        <div *ngFor="let platoonOption of getPlatoonOptions()">
          <a class="right" (click)="addPlatoon(platoonOption)">>></a>
          <span class="name">{{platoonOption.name}}</span>
        </div>
      </div>
    </div>
    <div class="col wdth-33 chosen-platoons">
      <div *ngIf="selectedFaction && !faction" class="active-squad front">
        <h2>{{selectedFaction.name.split(' ')[0]}}
          <span *ngIf="selectedFaction.name.indexOf(' ') !== -1">{{selectedFaction.name.substring(selectedFaction.name.indexOf(' '), selectedFaction.name.length)}}</span></h2>
        <img class="card-icon" src="{{getCardIcon('infantry')}}" alt="Card Icon" />
        <div class="card-container">
          <div class="card-front">
            <div class="main-image">
              <img src="{{selectedFaction.img}}" alt="{{selectedFaction.name}}" />
            </div>
            <div class="points-bar">
              <span *ngIf="selectedFaction.pointModifier && selectedFaction.pointModifier !== 1" class="points right">
                {{selectedFaction.getRoundedPoints()}}%pts
              </span>
              <h3 class="faction-nations">{{selectedFaction.getNations()}}</h3>
              <span class="points">Allies: {{selectedFaction.getAllies()}}</span>
            </div>
            <div class="lore-container">
              <p [innerHTML]="selectedFaction.lore"></p>
            </div>
          </div>
        </div>
      </div>
      <div *ngIf="nation && faction">
        <h3>Army</h3>
        <div class="platoon">
          <div class="platoon-info">
            <span class="name">Faction
              <a (click)="selectedFaction = faction; activeSquad = null">{{faction.name}}</a> {{getFactionPoints()}}pts</span>
          </div>
        </div>
        <div class="platoon" *ngFor="let platoon of armyList">
          <ng-container *ngIf="armyList.length > 0 || platoon.standard">
            <div class="platoon-info">
              <span class="name">{{platoon.name}} {{platoon.getPoints()}}pts</span>
              <a class="platoon-accordian right" (click)="platoon.expanded = !platoon.expanded">{{platoon.expanded ? '--' : '+'}}</a>
              <a class="platoon-edit right" (click)="platoon.editing=!platoon.editing">{{platoon.editing ? 'Save' : 'Edit'}}</a>
            </div>
            <div class="platoon-squads" [ngClass]="{'expanded': platoon.expanded}">
              <div *ngFor="let squad of platoon.squads">
                <div *ngIf="platoon.editing || squad.included">
                  <a (click)="viewSquad(squad, platoon)">{{squad.name}} {{squad.points}}pts</a>
                  <a class="right" *ngIf="!squad.required" (click)="squad.included = !squad.included">{{squad.included ? 'Remove' : 'Add'}}</a>
                </div>
              </div>
            </div>
          </ng-container>
        </div>
      </div>
    </div>
    <div class="col wdth-33">
      <div *ngIf="selectedFaction" class="active-squad faction-back">
        <h2>{{selectedFaction.name.split(' ')[0]}}
          <span *ngIf="selectedFaction.name.indexOf(' ') !== -1">{{selectedFaction.name.substring(selectedFaction.name.indexOf(' '), selectedFaction.name.length)}}</span></h2>
        <img class="card-icon" src="{{getCardIcon('infantry')}}" alt="Card Icon" />
        <div class="card-container">
          <div class="card-back">
            <div class="infantry-group">
              <h3>{{selectedFaction.name}} Platoons</h3>
              <div class="weapon" *ngFor="let platoon of selectedFaction.standardPlatoons">
                <div class="weapon-bar">
                  <div class="center-vertical">
                    <img src="assets/common/morale.png" alt="Standard Platoon" />
                    <span> {{platoon}}</span>
                  </div>
                </div>
              </div>
              <h3>Special Rules</h3>
              <div class="weapon">
                <div *ngFor="let special of selectedFaction.specials" class="weapon-special" [innerHTML]="replaceIcons(special)"></div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div *ngIf="nation && faction && !selectedFaction">
        <h3>Unit <a *ngIf="activeSquad" class="right" (click)="frontSide = !frontSide">Flip Card</a></h3>
        <div *ngIf="activeSquad">
          <div class="active-squad" [ngClass]="{'front': frontSide}">
            <h2>{{activeSquad.name.split(' ')[0]}}
              <span *ngIf="activeSquad.name.indexOf(' ') !== -1">{{activeSquad.name.substring(activeSquad.name.indexOf(' '), activeSquad.name.length)}}</span></h2>
            <img class="card-icon" src="{{getCardIcon(activeSquad.data.type)}}" alt="Card Icon" />
            <div class="card-container">
              <div *ngIf="frontSide" class="card-front">
                <div class="main-image">
                  <img src="{{activeSquad.data.img}}" alt="{{activeSquad.name}}" />
                </div>
                <div class="points-bar">
                  <span *ngIf="activeSquad.data.hq" class="hq">HQ</span>
                  <span class="points">{{activeSquad.points}}pts </span>
                  <span *ngIf="activeSquad.data.options" class="options">{{activeSquad.data.options}}opts</span>
                </div>
                <div class="lore-container">
                  <div *ngFor="let variant of activeSquad.data.variants" class="variant" (click)="toggleVariant(variant, true)" (contextmenu)="toggleVariant(variant, false); $event.preventDefault()">
                    <img class="unlock-icon" *ngIf="variant.unlocks > 0" src="assets/common/unlock.png" alt="Unlocked" />
                    <img class="lock-icon" *ngIf="!variant.unlocks" src="assets/common/lock.png" alt="Unlocked" />
                    <ng-container *ngIf="variant.max > 1">
                      <img class="unlock-icon" *ngIf="variant.unlocks > 1" src="assets/common/unlock.png" alt="Unlocked" />
                      <img class="lock-icon" *ngIf="!variant.unlocks || variant.unlocks < 2" src="assets/common/lock.png" alt="Unlocked" />
                    </ng-container>
                    <ng-container *ngIf="variant.max > 2">
                      <img class="unlock-icon" *ngIf="variant.unlocks > 2" src="assets/common/unlock.png" alt="Unlocked" />
                      <img class="lock-icon" *ngIf="!variant.unlocks || variant.unlocks < 3" src="assets/common/lock.png" alt="Unlocked" />
                    </ng-container>
                    <ng-container *ngIf="variant.max > 3">
                      <img class="unlock-icon" *ngIf="variant.unlocks > 3" src="assets/common/unlock.png" alt="Unlocked" />
                      <img class="lock-icon" *ngIf="!variant.unlocks || variant.unlocks < 4" src="assets/common/lock.png" alt="Unlocked" />
                    </ng-container>
                    <ng-container *ngIf="variant.max > 4">
                      <img class="unlock-icon" *ngIf="variant.unlocks > 4" src="assets/common/unlock.png" alt="Unlocked" />
                      <img class="lock-icon" *ngIf="!variant.unlocks || variant.unlocks < 5" src="assets/common/lock.png" alt="Unlocked" />
                    </ng-container>
                    <ng-container *ngIf="variant.max > 5">
                      <img class="unlock-icon" *ngIf="variant.unlocks > 5" src="assets/common/unlock.png" alt="Unlocked" />
                      <img class="lock-icon" *ngIf="!variant.unlocks || variant.unlocks < 6" src="assets/common/lock.png" alt="Unlocked" />
                    </ng-container>
                    +{{variant.points}}pts <span [innerHTML]="replaceIcons(variant.name)"></span>
                  </div>
                  <div class="hr" *ngIf="activeSquad.data.lore"></div>
                  <p *ngIf="activeSquad.data.lore">
                    {{activeSquad.data.lore}}
                  </p>
                  <p class="right" *ngIf="activeSquad.data.quote">
                    {{activeSquad.data.quote}}
                  </p>
                </div>
              </div>
              <div *ngIf="!frontSide" class="card-back">
                <div class="infantry-group" *ngFor="let infantrySection of activeSquad.data.infantry">
                  <div class="model-checkboxes">
                    <ng-container *ngIf="infantrySection.models">
                      <ng-container *ngFor="let i of [].constructor(infantrySection.models); let index = index">
                        <div class="clearfix" *ngIf="infantrySection.models > 9 && index % (infantrySection.models / 2) === 0 && index !== 0"></div>
                        <img class="checkbox right" (click)="activeSquad.cycleCheckbox(infantrySection.name + ':' + index)" src="{{activeSquad.getCheckboxSrc(infantrySection.name + ':' + index)}}" alt="Checkbox" />
                      </ng-container>
                    </ng-container>
                    <h3>
                      <span *ngIf="infantrySection.models > 1">{{infantrySection.models}}x </span>
                      {{infantrySection.name}}
                    </h3>
                  </div>
                  <div *ngFor="let weapon of infantrySection.weapons">
                    <div *ngIf="weaponMap[weapon.name]" class="weapon" [ngClass]="{'alt-ammo': weapon.altAmmo}">
                      <div class="weapon-bar">
                        <div class="right">
                          <span class="turret" *ngIf="weapon.hasOwnProperty('turret') && !weapon.hasOwnProperty('angle')">
                            <img src="assets/common/turret.png" alt="Turret" />
                            <span>{{getValue(weapon.name + ":turret", weapon.turret)}}</span>
                          </span>
                          <span class="angle" *ngIf="weapon.hasOwnProperty('angle') && !weapon.hasOwnProperty('turret')">
                            <img src="assets/common/angle.png" alt="Angle" />
                            <span>{{getValue(weapon.name + ":angle", weapon.angle)}}</span>
                          </span>
                          <span class="range">
                            <img src="assets/common/range.png" alt="Range" />
                            <span *ngIf="weapon.hasOwnProperty('range')">{{getValue(weapon.name + ":range", weapon.range)}}</span>
                            <span *ngIf="!weapon.hasOwnProperty('range')">{{getValue(weapon.name + ":range", weaponMap[weapon.name].range)}}</span>
                          </span>
                          <span *ngIf="!weaponMap[weapon.name].blast" class="shots">
                            <img src="assets/common/shots.png" alt="Shots" />
                            <span *ngIf="weapon.hasOwnProperty('shots')">{{getValue(weapon.name + ":shots", weapon.shots)}}</span>
                            <span *ngIf="!weapon.hasOwnProperty('shots')">{{getValue(weapon.name + ":shots", weaponMap[weapon.name].shots)}}</span>
                          </span>
                          <span *ngIf="weaponMap[weapon.name].blast" class="blast">
                            <img src="assets/common/blast.png" alt="Blast" />
                            <span *ngIf="weapon.hasOwnProperty('blast')">{{getValue(weapon.name + ":blast", weapon.blast)}}</span>
                            <span *ngIf="!weapon.hasOwnProperty('blast')">{{getValue(weapon.name + ":blast", weaponMap[weapon.name].blast)}}</span>
                          </span>
                          <span *ngIf="weaponMap[weapon.name].hitVehicle" class="hit-vehicle">
                            <img src="assets/common/hit-armor.png" alt="Hit Vehicle" />
                            <span *ngIf="weapon.hasOwnProperty('hitVehicle')">{{getValue(weapon.name + ":hitVehicle", weapon.hitVehicle)}}</span>
                            <span *ngIf="!weapon.hasOwnProperty('hitVehicle')">{{getValue(weapon.name + ":hitVehicle", weaponMap[weapon.name].hitVehicle)}}</span>
                          </span>
                          <span *ngIf="weaponMap[weapon.name].hitInfantry" class="hit-infantry">
                            <img src="assets/common/hit-infantry.png" alt="Hit Infantry" />
                            <span *ngIf="weapon.hasOwnProperty('hitInfantry')">{{getValue(weapon.name + ":hitInfantry", weapon.hitInfantry)}}</span>
                            <span *ngIf="!weapon.hasOwnProperty('hitInfantry')">{{getValue(weapon.name + ":hitInfantry", weaponMap[weapon.name].hitInfantry)}}</span>
                          </span>
                          <span *ngIf="weaponMap[weapon.name].damage" class="damage">
                            <img src="assets/common/damage.png" alt="Damage" />
                            <span *ngIf="weapon.hasOwnProperty('damage')">{{getValue(weapon.name + ":damage", weapon.damage)}}</span>
                            <span *ngIf="!weapon.hasOwnProperty('damage')">{{getValue(weapon.name + ":damage", weaponMap[weapon.name].damage)}}</span>
                          </span>

                        </div>
                        <span *ngIf="weapon.qty > 1">{{weapon.qty}}x </span>
                        {{weapon.name}}
                      </div>
                      <div class="clearfix"></div>
                      <div *ngIf="weapon.hasOwnProperty('special')">
                        <div *ngFor="let special of getSpecials(weapon.name + ':special', weapon.special)" class="weapon-special" [innerHTML]="replaceIcons(special)"></div>
                      </div>
                      <div *ngIf="!weapon.hasOwnProperty('special') && weaponMap[weapon.name].hasOwnProperty('special')">
                        <div *ngFor="let special of getSpecials(weapon.name + ':special', weaponMap[weapon.name].special)" class="weapon-special" [innerHTML]="replaceIcons(special)"></div>
                      </div>
                    </div>
                  </div>
                </div>
                <div *ngIf="activeSquad.data.type === 'car' || activeSquad.data.type === 'tank'" class="infantry-group">
                  <h3 *ngIf="!activeSquad.hasChassis()">Chassis</h3>
                  <div class="weapon">
                    <div class="weapon-bar">
                      <div class="right">
                        <span *ngIf="!activeSquad.data.bulletproof">
                          <img class="left checkbox" (click)="activeSquad.tracked = !activeSquad.tracked" src="{{activeSquad.tracked ? 'assets/common/killed.png' : 'assets/common/checkbox.png'}}" alt="Checkbox" />
                          <span class="left">½ Speed</span>
                        </span>
                        <img class="left checkbox" (click)="activeSquad.immobile = !activeSquad.immobile" src="{{activeSquad.immobile ? 'assets/common/killed.png' : 'assets/common/checkbox.png'}}" alt="Checkbox" />
                        <span class="left">Immobilized</span>
                      </div>
                      {{activeSquad.data.type === 'car' ? 'Wheels' : 'Tracks'}}
                    </div>
                  </div>
                  <h3>
                    <span *ngIf="activeSquad.data.crew && activeSquad.data.crew.length > 1">{{activeSquad.data.crew.length}}x </span>Crew
                  </h3>
                  <div *ngFor="let crew of activeSquad.data.crew" class="weapon">
                    <div class="weapon-bar">
                      <div class="center-vertical">
                        <img class="checkbox" (click)="activeSquad.cycleCheckbox(crew)" src="{{activeSquad.getCheckboxSrc(crew)}}" alt="Checkbox" />
                        <span>&nbsp;{{crew}}</span>
                      </div>
                    </div>
                  </div>
                </div>
                <div *ngIf="(activeSquad.data.abilities && activeSquad.data.abilities.length) || (faction.abilities && faction.abilities.length)" class="infantry-group">
                  <div class="hr"></div>
                  <div class="weapon">
                    <div *ngFor="let squadAbility of activeSquad.data.abilities" class="weapon-special" [innerHTML]="replaceIcons(squadAbility)"></div>
                    <div *ngFor="let factionAbility of faction.abilities" class="weapon-special" [innerHTML]="replaceIcons(factionAbility)"></div>
                  </div>
                </div>
                <div class="unit-stats">
                  <div class="move stat">
                    <img src="assets/common/move.png" alt="Movement" />
                    <span>{{getValue("move", activeSquad.data.move)}}cm</span>
                  </div>
                  <div class="defense stat">
                    <img *ngIf="activeSquad.data.type === 'infantry'" src="assets/common/infantry-defense.png" alt="Defense" />
                    <img *ngIf="activeSquad.data.type !== 'infantry'" src="assets/common/vehicle-defense.png" alt="Defense" />
                    <span>{{getValue("defense", activeSquad.data.armor)}}</span>
                  </div>
                  <div class="comms stat">
                    <ng-container *ngIf="!activeSquad.data.runner && !activeSquad.data.radio" >
                      <img src="assets/common/shout.png" alt="Shout" />
                      <span>{{getValue("comms", activeSquad.data.shout)}}</span>
                    </ng-container>
                    <ng-container *ngIf="!activeSquad.data.radio && activeSquad.data.runner">
                      <img  src="assets/common/runner.png" alt="Runner" />
                      <span>{{getValue("comms", activeSquad.data.runner)}}</span>
                    </ng-container>
                    <ng-container *ngIf="activeSquad.data.radio">
                      <img src="assets/common/radio.png" alt="Radio" />
                      <span>{{getValue("comms", activeSquad.data.radio)}}</span>
                    </ng-container>
                  </div>

                  <div class="morale stat">
                    <img src="assets/common/morale.png" alt="Morale" />
                    <span>{{getValue("morale", activeSquad.data.morale)}} /
                      {{getValue("moraleFrequency", activeSquad.data.moraleFrequency)}}</span>
                  </div>
                  <div class="hp stat">
                    <img src="assets/common/hp.png" alt="Hit Points" />
                    <span>{{getValue("hp", activeSquad.data.hp)}}</span>
                  </div>
                  <div class="close-combat stat">
                    <img src="assets/common/close-combat.png" alt="Close Combat" />
                    <span>{{getValue("closeCombat", activeSquad.data.closeCombat)}}</span>
                  </div>

                  <div class="characteristics">
                    <h3>CHARACTERISTICS</h3>
                    <p>{{activeSquad.getCharacteristics()}}</p>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
